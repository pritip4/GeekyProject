name: PR Title Template Automation
on:
  pull_request:
    types: [opened, edited]

jobs:
  update-pr:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Add this to fix the "no such file or directory" error
      - name: Checkout Repository
        uses: actions/checkout@v4 

      - name: Apply Template Based on Title
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const title = context.payload.pull_request.title.toLowerCase();
            let templatePath = '';

            // Map keywords to specific template files
            if (title.includes('bug')) {
              templatePath = '.github/PULL_REQUEST_TEMPLATE/bug_fix.md';
            } else if (title.includes('feat')) {
              templatePath = '.github/PULL_REQUEST_TEMPLATE/feature.md';
            }

            // Only update if a matching template was found and exists
            if (templatePath && fs.existsSync(templatePath)) {
              const template = fs.readFileSync(templatePath, 'utf8');
              github.rest.issues.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: template
              });
            } else if (templatePath) {
              console.log(`Matched keyword but file not found: ${templatePath}`);
            }
